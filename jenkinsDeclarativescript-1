pipeline{

agent any

tools{
maven 'maven3.9.3'

}

triggers {
  pollSCM('* * * * * ')
   //cron('* * * * * ')
}

options {
  //Add the timestamp to the console output 
  timestamps() 
  //Discard Old Builds 
  buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '5', daysToKeepStr: '', numToKeepStr: '5')
}
  
 stages{
//Get the code from Github
 stage('checkoutcode'){
 steps{

 git branch: 'development', credentialsId: '6374f7ba-ec40-499c-8c9d-918b74929134', url: 'https://github.com/nethajik21/maven-web-application.git

}
}

//Do the build
stage('Build'){
steps{
sh "mvn clean package" 

}
}

//Execute sonarQube Report 
stages('sonarQubeReport'){
steps{
sh mvn clean sonar:sonar
}
} 


//Upload Artifact into Nexus Server 
stage('Upload Artifact into Nexus Server') {
steps{
sh "mvn clean deploy" 
}


}


//Deploy App into Tomcat server 
stage('Deploy App into Tomcat Server'){
steps{
sshagent(['a0adeeef-0b78-48fe-892f-69bf54f70701']) {
    sh "scp -o StrictHostKeyChecking=no target/maven-web-application.war ec2-user@13.234.239.183:/opt/apache-tomcat-9.0.76/webapps/"
}

} 


}





}//stages closing 

post {
  always {
emailext body: '''Build Over...


Regards,
Netha Devops, ''', subject: 'Build Over ', to: 'nethajimahi98@gmail.com'
  }
  success {
emailext body: '''Build Over... Success


Regards,
Netha Devops, ''', subject: 'Build Over ', to: 'nethajimahi98@gmail.com'
  }
  failure {
emailext body: '''Build Over... Failure 


Regards,
Netha Devops, ''', subject: 'Build Over ', to: 'nethajimahi98@gmail.com'
  }
}

}//pipeline closing 
